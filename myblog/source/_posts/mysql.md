---
title: mysql
tags: 数据库
categories: 中间件
abbrlink: 9520183a
date: 2021-05-12 20:58:48
---

#### mysql中innodb和myisam

|            | innodb                                                       | myisam                                                   |
| ---------- | ------------------------------------------------------------ | -------------------------------------------------------- |
| 事务       | 支持                                                         | 不支持                                                   |
| 外键       | 支持                                                         | 不支持                                                   |
| 全文索引   | 不支持                                                       | 支持                                                     |
| 锁级别     | 行级锁                                                       | 表锁                                                     |
| 表空间大小 | 较大，约为myisam的2倍                                        | 较小                                                     |
| 索引       | 聚簇索引、索引就是数据，顺序存储，因此能缓存索引，也能缓存数据 | 非聚簇索引、索引和文件分开，随机存储，只能缓存索引       |
| 备份和恢复 | 拷贝数据文件、备份 binlog，或者用 mysqldump，数据量大时很慢  | 数据是以文件的形式存储，所以在跨平台的数据转移中会很方便 |

> myisam：节约空间，速度快，如果不注重事务或读取操作较多时选择myisam，其他情况选择innodb。

> innodb：安全性高、事务处理、多表多用户操作。

mysql的数据库信息都存在data目录下：

- InnoDB基于磁盘的资源是InnoDB表空间数据文件和它的日志文件，InnoDB 表的大小只受限于操作系统文件的大小
- MyISAM在磁盘上存储成三个文件。第一个文件的名字以表的名字开始，扩展名指出文件类型， .frm文件存储表定义，数据文件的扩展名为.MYD， 索引文件的扩展名是.MYI

#### mysql的事务ACID

- 原子性(A)：事务是最小单位，不可再分
- 一致性©：事务要求所有的DML语句操作的时候，必须保证同时成功或者同时失败
- 隔离性(I)：事务A和事务B之间具有隔离性
- 持久性(D)：是事务的保证，事务终结的标志(内存的数据持久到硬盘文件中)

> 隔离存在的并发问题

- 脏读：事务A读取了事务B更新的数据，然后B回滚操作（即未提交），那么A读取到的数据是脏数据
- 不可重复读：事务 A 多次读取同一数据，事务 B 在事务A多次读取的过程中，对数据作了更新并提交，导致事务A多次读取同一数据时，结果 不一致。
- 幻读：系统管理员A将数据库中所有学生的成绩从具体分数改为ABCDE等级，但是系统管理员B就在这个时候插入了一条具体分数的记录，当系统管理员A改结束后发现还有一条记录没有改过来，就好像发生了幻觉一样，这就叫幻读。

> 隔离级别的分类

| 事务隔离级别                 | 脏读 | 不可重复读 | 幻读 |
| ---------------------------- | ---- | ---------- | ---- |
| 读未提交（read-uncommitted） | 是   | 是         | 是   |
| 不可重复读（read-committed） | 否   | 是         | 是   |
| 可重复读（repeatable-read）  | 否   | 否         | 是   |
| 串行化（serializable）       | 否   | 否         | 否   |

**mysql默认的事务隔离级别为repeatable-read**

> mysql事务的常用方法

~~~SHELl
set autocommit =0   #关闭自动提交
set autocommit =1	#开启自动提交
Start Transaction	#开启事务
Commit 		#提交事务
Rollback 	#回滚事务
End Transaction			#事务结束

~~~

#### 索引 index

##### B-Tree索引

- **InnoDB使用的是B+Tree，每一个叶子节点都包含指向下一个叶子节点的指针，从而方便叶子节点的范围遍历。**
- **B-Tree通常意味着所有的值都是按顺序存储的，并且每一个叶子页到根的距离相同，很适合查找范围数据。**
- **B-Tree可以对<，<=，=，>，>=，BETWEEN，IN，以及不以通配符开始的LIKE使用索引。**

##### 索引的优缺点

> 优点：

- 建立索引的列可以保证行的唯一性，生成唯一的rowId
-  建立索引可以有效缩短数据的检索时间
-  建立索引可以加快表与表之间的连接
-  为用来排序或者是分组的字段添加索引可以加快分组和排序顺序

> 缺点：

- 创建索引和维护索引需要时间成本，这个成本随着数据量的增加而加大

- 创建索引和维护索引需要空间成本，每一条索引都要占据数据库的物理存储空间，数据量越大，占用空间也越大（数据表占据的是数据库的数据空间）

- 会降低表的增删改的效率，因为每次增删改索引需要进行动态维护，导致时间变长

##### 常见的索引类型

- 普通索引  	index

  **普通索引是最基本的索引，它没有任何限制。**

- 唯一索引     uniqe index

  **唯一索引和普通索引类似，主要的区别在于，唯一索引限制列的值必须唯一，但允许存在空值（只允许存在一条空值）。**

- 主键索引     primary key

  **主键索引是一种特殊的唯一索引，一个表只能有一个主键，不允许有空值。一般是在建表的时候同时创建主键索引**

- 组合索引     index

  **复合索引是在多个字段上创建的索引。复合索引遵守“最左前缀”原则，即在查询条件中使用了复合索引的第一个字段，索引才会被使用。因此，在复合索引中索引列的顺序至关重要。**

- 全文索引    fullText

  **FULLTEXT 索引在 MySQL 5.6 版本之后支持 InnoDB，而之前的版本只支持 MyISAM 表。一般用于模糊查询**

##### 索引失效场景

- 在where后使用or，导致索引失效（尽量少用or）
- 使用like ，like查询是以%开头
- 复合索引遵守“最左前缀”原则，即在查询条件中使用了复合索引的第一个字段，索引才会被使用
- 如果列类型是字符串，那一定要在条件中将数据使用引号引用起来,否则不使用索引
- 在索引字段上使用not，<>，!=。不等于操作符是永远不会用到索引的，因此对它的处理只会产生全表扫描
- DATE_FORMAT()格式化时间，格式化后的时间再去比较，可能会导致索引失效。
- is null， is not null也无法使用索引

##### 什么情况下不适合建立索引

- 小数据量的表不超过10万
- 数据变动强的字段不建立索引
- 大字段不建立索引
- 有枚举类型的字段不建议索引，或者建立组合索引

